<template>
	<ChatHeader :selectedChat="selectedChat" />
	<div class="chat__content">
		<div class="chat__messages">
			<div
				v-for="(message, index) in messages"
				:key="index"
				:class="['chat__message', getMessageClass(index)]"
			>
				<p class="chat__message-text">{{ message }}</p>
				<span class="chat__message-time">{{
					selectedChat.lastMessageTime
				}}</span>
			</div>
		</div>
		<div class="chat__input">
			<button class="chat__input-emoji">
				<svg
					width="24"
					height="24"
					viewBox="0 0 24 24"
					fill="none"
					xmlns="http://www.w3.org/2000/svg"
				>
					<path
						d="M12 1.99899C17.524 1.99899 22.002 6.47699 22.002 12.001C22.002 17.524 17.524 22.002 12 22.002C6.47599 22.002 1.99799 17.524 1.99799 12.001C1.99799 6.47699 6.47599 1.99899 12 1.99899ZM12 3.49899C10.8758 3.4868 9.76035 3.69769 8.7182 4.11946C7.67606 4.54124 6.72792 5.16551 5.92865 5.95616C5.12938 6.74681 4.49486 7.68813 4.06181 8.72563C3.62876 9.76314 3.40578 10.8762 3.40578 12.0005C3.40578 13.1248 3.62876 14.2378 4.06181 15.2754C4.49486 16.3129 5.12938 17.2542 5.92865 18.0448C6.72792 18.8355 7.67606 19.4597 8.7182 19.8815C9.76035 20.3033 10.8758 20.5142 12 20.502C14.232 20.4678 16.361 19.5571 17.9273 17.9665C19.4937 16.376 20.3716 14.2333 20.3716 12.001C20.3716 9.76871 19.4937 7.62597 17.9273 6.03545C16.361 4.44493 14.232 3.53423 12 3.49999V3.49899ZM8.46199 14.784C8.88273 15.32 9.41994 15.7532 10.0329 16.0509C10.6459 16.3485 11.3186 16.5028 12 16.502C12.6806 16.5028 13.3524 16.3489 13.9648 16.0519C14.5772 15.755 15.1141 15.3228 15.535 14.788C15.6583 14.6319 15.8386 14.5312 16.0362 14.5081C16.2337 14.4849 16.4324 14.5412 16.5885 14.6645C16.7446 14.7878 16.8453 14.9681 16.8684 15.1657C16.8916 15.3632 16.8353 15.5619 16.712 15.718C16.1507 16.4306 15.435 17.0064 14.6187 17.4021C13.8025 17.7977 12.9071 18.0028 12 18.002C11.0917 18.0027 10.1952 17.797 9.3782 17.4002C8.56118 17.0035 7.84506 16.4262 7.28399 15.712C7.16618 15.5553 7.11438 15.3588 7.13966 15.1644C7.16495 14.9701 7.26532 14.7933 7.41928 14.6721C7.57324 14.5508 7.76857 14.4946 7.96345 14.5155C8.15833 14.5364 8.33727 14.6328 8.46199 14.784ZM8.99999 8.74999C9.16705 8.74527 9.33336 8.77409 9.48909 8.83476C9.64481 8.89542 9.7868 8.9867 9.90663 9.1032C10.0265 9.21969 10.1217 9.35904 10.1868 9.51298C10.2518 9.66693 10.2853 9.83237 10.2853 9.99949C10.2853 10.1666 10.2518 10.3321 10.1868 10.486C10.1217 10.64 10.0265 10.7793 9.90663 10.8958C9.7868 11.0123 9.64481 11.1036 9.48909 11.1642C9.33336 11.2249 9.16705 11.2537 8.99999 11.249C8.67472 11.2398 8.36586 11.1041 8.13904 10.8708C7.91223 10.6375 7.78534 10.3249 7.78534 9.99949C7.78534 9.67409 7.91223 9.36152 8.13904 9.1282C8.36586 8.89488 8.67472 8.7592 8.99999 8.74999ZM15 8.74999C15.167 8.74527 15.3334 8.77409 15.4891 8.83476C15.6448 8.89542 15.7868 8.9867 15.9066 9.1032C16.0265 9.21969 16.1217 9.35904 16.1868 9.51298C16.2518 9.66693 16.2853 9.83237 16.2853 9.99949C16.2853 10.1666 16.2518 10.3321 16.1868 10.486C16.1217 10.64 16.0265 10.7793 15.9066 10.8958C15.7868 11.0123 15.6448 11.1036 15.4891 11.1642C15.3334 11.2249 15.167 11.2537 15 11.249C14.6747 11.2398 14.3659 11.1041 14.139 10.8708C13.9122 10.6375 13.7853 10.3249 13.7853 9.99949C13.7853 9.67409 13.9122 9.36152 14.139 9.1282C14.3659 8.89488 14.6747 8.7592 15 8.74999Z"
						fill="#707991"
					/>
				</svg>
			</button>
			<input
				type="text"
				class="chat__input-field"
				placeholder="Напишите сообщение"
				@keyup.enter="sendMessage"
				v-model="newMessage"
			/>
			<button class="chat__input-button" @click="sendMessage">
				<svg
					width="24"
					height="24"
					viewBox="0 0 24 24"
					fill="none"
					xmlns="http://www.w3.org/2000/svg"
				>
					<path
						d="M12.815 12.197L5.28299 13.453C5.19639 13.4675 5.11513 13.5045 5.04737 13.5603C4.97961 13.6161 4.92775 13.6888 4.89699 13.771L2.29999 20.728C2.05199 21.368 2.72099 21.978 3.33499 21.671L21.335 12.671C21.4597 12.6088 21.5645 12.513 21.6378 12.3945C21.7111 12.276 21.7499 12.1394 21.7499 12C21.7499 11.8607 21.7111 11.7241 21.6378 11.6055C21.5645 11.487 21.4597 11.3913 21.335 11.329L3.33499 2.32901C2.72099 2.02201 2.05199 2.63301 2.29999 3.27201L4.89799 10.229C4.9286 10.3114 4.98041 10.3843 5.04818 10.4403C5.11594 10.4963 5.19728 10.5335 5.28399 10.548L12.816 11.803C12.8623 11.8111 12.9043 11.8353 12.9346 11.8714C12.9649 11.9074 12.9815 11.9529 12.9815 12C12.9815 12.0471 12.9649 12.0926 12.9346 12.1287C12.9043 12.1647 12.8623 12.1889 12.816 12.197H12.815Z"
						fill="#8BABD8"
					/>
				</svg>
			</button>
		</div>
	</div>
</template>

<script>
import { ref, watch } from 'vue'
import ChatHeader from './ChatHeader.vue'

export default {
	components: {
		ChatHeader,
	},

	props: {
		selectedChat: {
			type: Object,
			required: true,
		},
	},

	emits: ['newMessage'],

	setup(props, { emit }) {
		const newMessage = ref('')
		const messages = ref([])

		watch(
			() => props.selectedChat.id,
			newChatId => {
				const storedMessages = localStorage.getItem(`chat-${newChatId}`)
				messages.value = storedMessages ? JSON.parse(storedMessages) : []
			}
		)

		const sendMessage = () => {
			if (newMessage.value.trim()) {
				messages.value.push(newMessage.value)
				localStorage.setItem(
					`chat-${props.selectedChat.id}`,
					JSON.stringify(messages.value)
				)

				emit('newMessage', props.selectedChat.id, newMessage.value)
				newMessage.value = ''
			}
		}

		const getMessageClass = index => {
			return index % 2 === 0 ? 'chat__message--output' : 'chat__message--input'
		}

		return {
			newMessage,
			messages,
			sendMessage,
			getMessageClass,
		}
	},
}
</script>

<style scoped lang="scss"></style>
